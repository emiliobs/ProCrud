@using System.ComponentModel.DataAnnotations
@* NOTA: No ponemos @inject aquí porque ya está en el constructor del .cs *@

<MudDialog>
    <DialogContent>
        <MudText Typo="Typo.h6">@Title</MudText>
        <MudDivider Class="my-3" />

        <EditForm Model="_editModel" OnValidSubmit="SaveAsync">
            <DataAnnotationsValidator />
            <MudStack Spacing="2">

                <MudTextField Label="Nombre"
                              @bind-Value="_editModel.Name"
                              For="@(() => _editModel.Name)"
                              Variant="Variant.Outlined" />

                <MudTextField Label="Descripción"
                              Lines="3"
                              @bind-Value="_editModel.Description"
                              For="@(() => _editModel.Description)"
                              Variant="Variant.Outlined" />

                <MudNumericField T="decimal"
                                 Label="Precio"
                                 @bind-Value="_editModel.Price"
                                 For="@(() => _editModel.Price)"
                                 Variant="Variant.Outlined"
                                 Adornment="Adornment.Start"
                                 AdornmentIcon="@Icons.Material.Filled.AttachMoney" />

                @* SOLUCIÓN ERROR MUD-SWITCH: Especificamos T="bool" *@
                <MudSwitch T="bool"
                           @bind-Checked="_editModel.IsActive"
                           Color="Color.Primary">
                    Activo
                </MudSwitch>

                <MudSelect T="Guid"
                           Label="Categoría"
                           @bind-Value="_editModel.CategoryId"
                           For="@(() => _editModel.CategoryId)"
                           Variant="Variant.Outlined"
                           AnchorOrigin="Origin.BottomCenter">

                    @* SOLUCIÓN ERROR NULL REF: Verificamos que Categories no sea nulo *@
                    @if (Categories is not null)
                    {
                        @foreach (var c in Categories)
                        {
                            <MudSelectItem T="Guid" Value="c.Id">@c.Name</MudSelectItem>
                        }
                    }
                </MudSelect>

                <ValidationSummary />
            </MudStack>

            <MudDivider Class="my-4" />

            <MudStack Row="true" Justify="Justify.FlexEnd" Spacing="2">
                <MudButton Variant="Variant.Text" OnClick="CancelAsync">Cancelar</MudButton>
                <MudButton Variant="Variant.Filled" Color="Color.Primary" ButtonType="ButtonType.Submit">
                    Guardar
                </MudButton>
            </MudStack>
        </EditForm>
    </DialogContent>
</MudDialog>